---
title: "MW_WTAanalysis"
author: "Janneke Hille Ris Lambers, Aji John, Meera Sethi, Elli Theobald"
date: "06/07/2021"
output: html_document
---

# Setup R markdown, load packages
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(ggplot2)
library(MASS)
library(boot)
library(dplyr)
library(randomForest)
library(brant)
```

#Objective 1 Data wrangling
This code chunk:
1. Reads in necessary data
     +read in NPS visitation data
     +read in peak flowering data (per plot, year, species)
     +read in WTA data
     +read flowering richness by day
2. Creates data frames of NPS visits, peak flowering, WTA posts
     +reconfigure NPS visitation data, subset to years / months
     +WTA data: count # reports per year month
     +turn peak flowering estimates (julian day) into monthly data
3. Creates a data frame of SDD vS dates

```{r}

# Read in all necessary data
MW_plot_dat_0 <- read.csv("output/Parameters_plotmodel.csv")
WTA_dat_0a <- read.csv("data/GB_WTA.csv", header=TRUE)
WTA_dat_0b <- read.csv("data/ST_WTA.csv", header=TRUE)
WTA_dat_0 <- rbind(WTA_dat_0a, WTA_dat_0b)
NPS_dat_0 <- read.csv("data/Visitation by Month.csv",stringsAsFactors = TRUE)
SDDdat <- read.csv("output/MeadowSDD.csv", header=TRUE) 

## FOR OBJECTIVE 1
# Create timing data frame with 5 columns
# year, type (visitor, WTA, peak), trail, month, # items
# Note - constrain to April, May, Jun, Jul, Aug, Sep, Oct

#  NPS data - recreational visits
yr_nps <- rep(NPS_dat_0$Year, times=7)
typ_nps <- as.factor(rep("NPS", times=length(yr_nps)))
trail_nps <- rep(NA, times=length(yr_nps))
month_nps <- as.factor(rep(c("Apr","May","Jun","Jul","Aug","Sep","Oct"),
                      each=dim(NPS_dat_0)[1]))
nitems_nps <- c(NPS_dat_0$APR, NPS_dat_0$MAY, NPS_dat_0$JUN, 
                NPS_dat_0$JUL, NPS_dat_0$AUG, NPS_dat_0$SEP,
                NPS_dat_0$OCT)
NPS_visits_1 <- data.frame(yr_nps, typ_nps, trail_nps, 
                   month_nps, nitems_nps)
NPS_visits <- NPS_visits_1[NPS_visits_1$yr_nps>2012,]
dimnames(NPS_visits)[[2]] <- c("year","type","trail",
                            "month","n")

# WTA data - # reports per month
WTA_reports_1 <- subset(WTA_dat_0, select=c(orig.position, trail, year, month))
WTA_reports_2 <- distinct(WTA_reports_1)
WTA_reports_3a <- WTA_reports_2[WTA_reports_2$year>2012 & WTA_reports_2$year<2020 &
                          WTA_reports_2$trail=="skyline loop",]
WTA_reports_3b <- WTA_reports_2[WTA_reports_2$year>2014 & 
                                WTA_reports_2$year<2020 &
                                WTA_reports_2$trail=="glacier basin",]
WTA_reports_3 <- rbind(WTA_reports_3a, WTA_reports_3b)
WTA_reports_3$month <- substring(WTA_reports_3$month,1,3)
WTA_reports_3$trail[WTA_reports_3$trail=="glacier basin"] <- "GB"
WTA_reports_3$trail[WTA_reports_3$trail=="skyline loop"] <- "RL"
mnths <- c("Apr","May","Jun","Jul","Aug","Sep","Oct")
mnthskeep <- WTA_reports_3$month %in% mnths
WTA_reports_4 <- WTA_reports_3[mnthskeep,]
WTA_reports_4$trail <- as.factor(WTA_reports_4$trail)
WTA_reports_4$month <- as.factor(WTA_reports_4$month)
WTA_reports_5a <- WTA_reports_4 %>% 
  group_by(year, trail, month)%>% 
  tally() %>% as.data.frame()

#Add zeros to WTA data (NB - will need to add skyline trail)
WTA_reports_5b <- rbind(NPS_visits, NPS_visits)
WTA_reports_5b$type <- "WTA"
WTA_reports_5b$trail <- c(rep("GB", times=dim(NPS_visits)[1]),
                        rep("RL", times=dim(NPS_visits)[1]))
WTA_reports_5b$n <- 0
WTA_reports_5c <- merge(WTA_reports_5b, WTA_reports_5a, all.x=TRUE,
                    by=c("year","trail","month"))
WTA_reports_5c$n.y[is.na(WTA_reports_5c$n.y)==TRUE] <- 0
WTA_reports_5c$n.x <- NULL
dimnames(WTA_reports_5c)[[2]][5] <- "n"
WTA_reports_6a <- WTA_reports_5c[WTA_reports_5c$trail=="GB"&
                                WTA_reports_5c$year>2014,]
WTA_reports_6b <- WTA_reports_5c[WTA_reports_5c$trail=="RL"
                                 &WTA_reports_5c$year>2012,]
WTA_reports <- rbind(WTA_reports_6a, WTA_reports_6b)

# MW data - number of species in peak flower per month
dimnames(MW_plot_dat_0)[[2]][2] <- "trail"
MW_plot_dat_0$trail[MW_plot_dat_0$trail=="Reflection Lakes"] <- "RL"
MW_plot_dat_0$trail[MW_plot_dat_0$trail=="Glacier Basin"] <- "GB"
keepcol <- c("year","trail","species","peak")
MW_plot_dat_1 <- MW_plot_dat_0[,keepcol]
MW_plot_dat_1$peak <- round(MW_plot_dat_1$peak)
Jan1Jul <- as.Date(paste(MW_plot_dat_1$year,"-01-01", sep=""))
MW_date <- as.Date(MW_plot_dat_1$peak, origin = Jan1Jul)
MW_plot_dat_1$month <- format(MW_date, "%b")
MW_plot_dat_1$type <- "MW"
MW_flowers_2a <- MW_plot_dat_1 %>% 
  group_by(year, trail, month)%>% 
  tally() %>% as.data.frame()

# MW data - add zeros
MW_flowers_1a <- NPS_visits
MW_flowers_1a <- MW_flowers_1a[MW_flowers_1a$year>2012,]
MW_flowers_1a$type <- "MW"
MW_flowers_1a$trail <- "GB"
MW_flowers_1b <- MW_flowers_1a
MW_flowers_1b$trail <- "RL"
MW_flowers_2b <- rbind(MW_flowers_1a, MW_flowers_1b)
MW_flowers_2b$n <- 0
MW_flowers_3  <- merge(MW_flowers_2b, MW_flowers_2a, all.x=TRUE,
                    by=c("year","trail","month"))
MW_flowers_3$n.y[is.na(MW_flowers_3$n.y)==TRUE] <- 0
MW_flowers_3$n.x <- NULL
dimnames(MW_flowers_3)[[2]][5] <- "n"
colorder <- dimnames(NPS_visits)[[2]]
MW_flowers_3 <- MW_flowers_3[,colorder]
MW_flowers <- MW_flowers_3[!(MW_flowers_3$trail=="GB" & 
                            MW_flowers_3$year<2015),]

# Now make data frame of dates by SDD 
SDDyear_0 <- tapply(SDDdat$SDD, list(SDDdat$Year, SDDdat$Transect), mean)
SDDyear_1a <- cbind(as.numeric(dimnames(SDDyear_0)[[1]]),
                     rep(dimnames(SDDyear_0)[[2]][1],
                         times=dim(SDDyear_0)[1]),
                         SDDyear_0[,1])
SDDyear_1b <- cbind(as.numeric(dimnames(SDDyear_0)[[1]]),
                     rep(dimnames(SDDyear_0)[[2]][2],
                         times=dim(SDDyear_0)[1]),
                         SDDyear_0[,2])                    

#Put together
Yeardat <- rbind(SDDyear_1a, SDDyear_1b)
dimnames(Yeardat) <- list(c(), c("Year","Trail","SDD"))
Yeardat <- data.frame(Yeardat)
Yeardat <- Yeardat[is.na(Yeardat$SDD)==FALSE,]
Yeardat <- Yeardat[Yeardat$Year!=2020,]
Yeardat$Trail[Yeardat$Trail=="Glacier Basin"] <- "GB"
Yeardat$Trail[Yeardat$Trail=="Reflection Lakes"] <- "RL"
Yeardat$SDD <- as.numeric(Yeardat$SDD)
Yeardat$SDD <- round(Yeardat$SDD, 2)

#Create MWatch means
MWyear_0 <- tapply(MW_plot_dat_0$peak,
                   list(MW_plot_dat_0$year, MW_plot_dat_0$trail), mean)
MWyear_0 <- as.data.frame(MWyear_0)

#Add to yeardat
Yeardat$MW <- c(na.omit(MWyear_0$GB), MWyear_0$RL)

#Create WTA means; first calculate Julian Day
WTAyear_1 <- subset(WTA_dat_0, select=c(orig.position, trail, year, month, day))
WTAyear_2 <- distinct(WTAyear_1)
WTAyear_2$month2 <- substr(WTAyear_2$month,1,3)

# Define the wildflower community: which species to include
mnths <- c("Apr","May","Jun","Jul","Aug","Sep","Oct")

# Restrict to certain months
mnthskeep <- WTAyear_2$month2 %in% mnths
WTAyear_3 <- WTAyear_2[mnthskeep,]
WTAyear_4 <- WTAyear_3[WTAyear_3$year>2012,]

#Now use to create DOY
DOY <- c()

# Convert the 'Date' - observed date to Julian (DOY)
for(i in 1:dim(WTAyear_4)[1]){
  year <- WTAyear_4$year[i]
  month <- WTAyear_4$month[i]
  day <- WTAyear_4$day[i]
  tmpdate <- paste(month,day,year, sep=" ")
  Jan1Jul <- as.Date(paste(year,"-01-01", sep=""))
  ObsJulDayYr <- julian(as.Date(tmpdate,"%B %d %Y"),
                        origin=Jan1Jul)
  DOY <- c(DOY,ObsJulDayYr)
}

WTAyear_4$DOY <- DOY

#Create WTA means
WTAyear_5 <- tapply(WTAyear_4$DOY,
                   list(WTAyear_4$year, WTAyear_4$trail), mean)
WTAyear_5 <- WTAyear_5[dimnames(WTAyear_5)[[1]]!="2020",]

#Add to Yeardat
Yeardat$WTA <- c(WTAyear_5[-c(1:2),1], WTAyear_5[,2])

#NPS means
month_num <- match(NPS_visits$month, month.abb)
NPS_visits$month_num <- month_num
NPS_visits_n <- NPS_visits
NPS_visits_n$mnprod <- NPS_visits_n$n*NPS_visits_n$month_num
NPS_totalyear <- tapply(NPS_visits_n$n, NPS_visits_n$year, sum)
NPS_mnprodsumyear <- tapply(NPS_visits_n$mnprod, NPS_visits_n$year, sum)
NPS_monthvisit <- NPS_mnprodsumyear / NPS_totalyear

#add to yeardat, ReflLakes
Yeardat$NPS <- c(rep(NA, times=5),NPS_monthvisit*30)

#Create a second data frame (Yeardat2), for analysis
TimingType <- as.factor(c(rep("NPS", times=dim(Yeardat)[1]),
                   rep("WTA", times=dim(Yeardat)[1]),
                   rep("MW", times=dim(Yeardat)[1])))
Yeardat2 <- data.frame(TimingType)
Yeardat2$Year <- c(Yeardat$Year, Yeardat$Year, Yeardat$Year)
Yeardat2$SDD <- c(Yeardat$SDD, Yeardat$SDD, Yeardat$SDD)
Yeardat2$Timing <- c(Yeardat$NPS, Yeardat$WTA, Yeardat$MW)
Yeardat2 <- Yeardat2[is.na(Yeardat2$Timing)==FALSE,]

```

# Objective 1: Figure 2 & analysis
This code chunk plots a 3 row 2 column figure, with the distributions of wildflowers in peak flower and WTA posts (one line per year) in the first two rows, one column per trail. The last row shows the number of visitors to NPS and a scatterplot of Snow duration vs. peak flowering, WTA posts, and visitors.

This code chunk also contains the analyses of peak flowering, WTA trip reports, and NPS visitation as a function of snow disappearance.
```{r}
##```{r, fig1, fig.height=6, fig.width=5, fig.align="center"}

# set option for making figure: pdf or tiff
#pdf(file="output/figures/Fig2.pdf", width=5, height=6, title="")
tiff(file="output/figures/Fig2.tif", width=5, height=6, units="in", res=1000)

# Make 3x2 panel figure showing all data over time
par(mfrow=c(3,2), omi=c(0,0,0,0), mai=c(0.35,0.35,0.35,0.25),
    mgp=c(1.2,0.4,0), tck=-0.02)
#yrs <- unique(NPS_visits$year); yrs <- c(2013,2014,2016,2017,2018,2019,2015)
yrs <- unique(NPS_visits$year); yrs <- yrs[order(yrs, decreasing=TRUE)]

#create vector of colors depending on year
YeardatRL <- Yeardat[Yeardat$Trail=="RL",]
YeardatRL <- YeardatRL[order(YeardatRL$Year, decreasing=TRUE),]

#create color ramp: rank SDD
rankSDD <- rank(YeardatRL$SDD)-1
SDDramp <- rankSDD/6
SDDcolramp <- colorRamp(c("aliceblue","navyblue"),
                        space="rgb", interpolate="spline")
SDDcols <- rgb(SDDcolramp(SDDramp), maxColorValue=255)

# MW_dat
trls <- c("GB", "RL")
month_num <- match(MW_flowers$month, month.abb)
MW_flowers$month_num <- month_num

for(i in 1:2){
  plot(c(6,1), type="n", xaxt="n", xlim=c(3.5,10.5), ylim=c(0,1.0),
       xlab="Month", ylab="Peak Flowering (proportion)")
  title(paste("MW Flowering (",trls[i],")",sep=""))
  text(c(4,5,6,7,8,9,10),-0.1, xpd=NA, 
      labels=c("Apr","May","June","July","Aug","Sep","Oct"))
  #add a, b
  if(i==1){mtext("a)", side=3, line=-1, cex=0.65, adj=0.025)}
  if(i==2){mtext("b)", side=3, line=-1, cex=0.65, adj=0.025)}
  
  if(i==1){
    legend(x="topright", legend=c("Latest snow", "Earliest snow"), 
       cex=0.75, pch=21, pt.bg=c("navyblue","aliceblue"),
       pt.cex=1.75)}

  for(j in 1:length(yrs)){
    yrvisits <- MW_flowers[MW_flowers$year==yrs[j]&MW_flowers$trail==trls[i],]
    yrvisits <- yrvisits[order(yrvisits$month_num),]
    lines(yrvisits$month_num, yrvisits$n/sum(yrvisits$n))
  }

  for(j in 1:length(yrs)){
    yrvisits <- MW_flowers[MW_flowers$year==yrs[j]&MW_flowers$trail==trls[i],]
    ifelse(j<7, ptsize<-1.75, ptsize<-1.75)
    points(yrvisits$month_num, yrvisits$n/sum(yrvisits$n), 
          #cex=ptsize, pch=21, bg=yrcols[j])
          cex=ptsize, pch=21, bg=SDDcols[j])
  }
}

# WTA_dat
month_num <- match(WTA_reports$month, month.abb)
WTA_reports$month_num <- month_num

for(i in 1:2){
  plot(c(6,1), type="n", xaxt="n", xlim=c(3.5,10.5), ylim=c(0,0.6),
       xlab="Month", ylab="Trip Reports (proportion)")
  title(paste("WTA Trips (",trls[i],")",sep=""))
  text(c(4,5,6,7,8,9,10), -0.06, xpd=NA, 
        labels=c("Apr","May","June","July","Aug","Sep","Oct"))
  #add a, b
  if(i==1){mtext("c)", side=3, line=-1, cex=0.65, adj=0.025)}
  if(i==2){mtext("d)", side=3, line=-1, cex=0.65, adj=0.025)}
  
  for(j in 1:length(yrs)){
    yrvisits <- WTA_reports[WTA_reports$year==yrs[j] 
                            & WTA_reports$trail==trls[i],]
    yrvisits <- yrvisits[order(yrvisits$month_num),]
    lines(yrvisits$month_num, yrvisits$n/sum(yrvisits$n))
  }

  for(j in 1:length(yrs)){
    yrvisits <- WTA_reports[WTA_reports$year==yrs[j]
                            &WTA_reports$trail==trls[i],]
    ifelse(j<7, ptsize<-1.75, ptsize<-1.75)
    points(yrvisits$month_num, yrvisits$n/sum(yrvisits$n), 
            #cex=ptsize, pch=21, bg=yrcols[j])
            cex=ptsize, pch=21, bg=SDDcols[j])
  }
}

# NPS visitation
plot(c(6,1), type="n", xaxt="n", xlim=c(3.5,10.5), ylim=c(0,0.5),
     xlab="Month", ylab="Visitors (Proportion)")
title("NPS Visits")
text(c(4,5,6,7,8,9,10), -0.05, xpd=NA, 
      labels=c("Apr","May","June","July","Aug","Sep","Oct"))
mtext("e)", side=3, line=-1, cex=0.65, adj=0.025)

for(i in 1:length(yrs)){
  yrvisits <- NPS_visits[NPS_visits$year==yrs[i],]
  lines(yrvisits$month_num, yrvisits$n/sum(yrvisits$n))
}

for(i in 1:length(yrs)){
  yrvisits <- NPS_visits[NPS_visits$year==yrs[i],]
  ifelse(i<7, ptsize<-1.75, ptsize<-1.75)
  points(yrvisits$month_num, yrvisits$n/sum(yrvisits$n), 
         cex=ptsize, pch=21, bg=SDDcols[j])
         #cex=ptsize, pch=21, bg=yrcols[i])
}

#Final panel (f), and statistical tests
#first, simple linear regression for each timig type
Flwrtest <- lm(Yeardat$MW~Yeardat$SDD)
WTAtest <- lm(Yeardat$WTA~Yeardat$SDD)
NPStest <- lm(Yeardat$NPS~Yeardat$SDD)

#Now overall test of timing by SDD and interaction
testall <- lm(Timing~SDD*TimingType, data=Yeardat2)

#report out results
summary(Flwrtest); summary(WTAtest); summary(NPStest)
summary(testall); anova(testall)


#Now, Scatter plot of SDD vs timing for all 3 types of data
plot(c(180,180), type="n", xaxt="n", xlim=c(120,210), ylim=c(180,240),
     xaxp=c(120,210,2), yaxp=c(180,240,1), xaxt="n", yaxt="n",
     xlab="Snow disappearance", ylab="Timing (Avg)")
title("Climate vs. Peak")
text(c(135, 165, 195), 174, xpd=NA, 
      labels=c("May","Jun","Jul"))
text(112, c(195, 225), xpd=NA, srt=90, labels=c("Jul","Aug"))
mtext("f)", side=3, line=-1, cex=0.65, adj=0.025)
cls <- c("magenta","yellowgreen","chocolate4")

legend(x="bottomright", legend=c("MW","WTA","NPS"),
       lty=1, col=cls, pch=21, pt.bg=cls, pt.cex=1.5, cex=0.75)


#add lines for each data type based on linear regression for reach of data
mnmxx_SDD <- c(min(Yeardat$SDD), max(Yeardat$SDD))
mnmxy_flwr <- coef(Flwrtest)[1] + coef(Flwrtest)[2]*mnmxx_SDD
lines(mnmxx_SDD, mnmxy_flwr, col=cls[1], lwd=1.5)
mnmxy_wta <- coef(WTAtest)[1] + coef(WTAtest)[2]*mnmxx_SDD
lines(mnmxx_SDD, mnmxy_wta, col=cls[2], lwd=1.5)
mnmxx_nps <- c(min(Yeardat$SDD[is.na(Yeardat$NPS)==FALSE]), 
               max(Yeardat$SDD[is.na(Yeardat$NPS)==FALSE]))
mnmxy_nps <- coef(NPStest)[1] + coef(NPStest)[2]*mnmxx_nps
lines(mnmxx_nps, mnmxy_nps, col=cls[3], lwd=1.5)

#add points for each data type
for(i in 4:6){
  points(Yeardat$SDD, Yeardat[,i], cex=2, pch=21, bg=cls[i-3])
}

legend(x="bottomright", legend=c("MW","WTA","NPS"),
       lty=1, col=cls, pch=21, pt.bg=cls, pt.cex=1.5, cex=0.75)

dev.off()

```

#Objective 2 Sentiment wrangling, data exploration
This code chunk:
1. Wrangles the WTA data, by taking average sentiments after removing the most extreme value. This is done on a sentiment by sentiment basis.
2. Describes sentiments
  +How many NAs?
  +Histogram of sentiments?

```{r fig1, fig.height=7, fig.width=4.5, fig.align="center"}
# Remove some columns
WTA_dat_1 <- subset(WTA_dat_0, select=-c(pre.2013, dummy.random.order, link,
                                         other.trails, other.trails.mw, author, 
                                         flowers.in.pics.spp, spp.mentioned,
                                         wildflower.value.terms, value.terms, 
                                         flag, flag.comment, 
                                         flag.resolved.comment, conflictive))
  
# Remove rows with NAs in overall sentiment
WTA_dat_2 <- WTA_dat_1[is.na(WTA_dat_1$overall.report.sentiment)==FALSE,]

#rm 2020 values
WTA_dat_2 <- WTA_dat_2[WTA_dat_2$year!=2020,]

# Only include years in which MW data was collected in GB
WTA_dat_3a <- WTA_dat_2[WTA_dat_2$year>2014&WTA_dat_2$trail=="glacier basin",]
WTA_dat_3b <- WTA_dat_2[WTA_dat_2$year>2012&WTA_dat_2$trail=="skyline loop",]
WTA_dat_3 <- rbind(WTA_dat_3a, WTA_dat_3b)

# new data set: average score, after NAs (this may not be the best way to go) 
WTA_dat_4a <- subset(WTA_dat_3, select=c(orig.position, trail, year, month,
                                         day, flowerbadge, bugs.summary,
                                         snow.summary))
postrail <- paste(WTA_dat_4a$trail, WTA_dat_4a$orig.position)
WTA_dat_4a <- WTA_dat_4a[order(postrail),]
WTA_dat_4b <- distinct(WTA_dat_4a)
sentiments <- c()

for(i in 1:dim(WTA_dat_4b)[1]){
  trl <- WTA_dat_4b$trail[i]; pos <- WTA_dat_4b$orig.position[i]
  report_dat <- WTA_dat_3[WTA_dat_3$orig.position==pos 
                          & WTA_dat_3$trail==trl,]
  #place to put sentiments
  report_sentiments <- c()
  
  for(j in 13:20){
    #get raw sentiments
    tmp_s1 <- na.omit(report_dat[,j])
    if(length(tmp_s1)==0){tmp_s2 <- NA}
    if(length(tmp_s1)<3 & length(tmp_s1)>0){tmp_s2 <- mean(tmp_s1)}
    if(length(tmp_s1)==3){
        prdf <- c(mean(abs(tmp_s1[1]-tmp_s1[2:3])),
              mean(abs(tmp_s1[2]-tmp_s1[c(1,3)])),
              mean(abs(tmp_s1[3]-tmp_s1[1:2])))
        drops <- which(prdf[]==max(prdf))
        if(length(drops)==1){tmp_s2 <- mean(tmp_s1[-drops])}
        if(length(drops)>1){tmp_s2 <- mean(tmp_s1)}
    }
    report_sentiments <- c(report_sentiments, tmp_s2)
  }
  sentiments <- rbind(sentiments, report_sentiments)
}

dimnames(sentiments) <- list(c(), c("bug.s","wildlife.s","crowd.s",
                                    "trail.s", "weather.s","view.s",
                                    "wildflower.s","total.s"))
sentiments <- as.data.frame(sentiments)

#merge for finalized WTA data
WTA_dat <- cbind(WTA_dat_4b, sentiments)

# Check how many NA's per sentiment score
for(i in 9:16){
  scores <- length(na.omit(WTA_dat[,i]))
  print(paste(dimnames(WTA_dat)[[2]][i],"scored =", 
              scores, " of ", dim(WTA_dat)[1]))
}

# Make histogram of sentiments
par(mfrow=c(4,2), omi=c(0,0,0,0), mai=c(0.4,0.4,0.4,0.4), 
    tck=-0.02, mgp=c(1.1,0.4,0))

for(i in 9:16){
  hist(WTA_dat[,i], col="grey", xlab="sentiment",ylab="freq",
       breaks=c(0,1,2,3,4,5), main=dimnames(WTA_dat)[[2]][i])
  mean_s <- round(mean(na.omit(WTA_dat[,i])),2)
  mtext(paste("mean=",mean_s, sep=""), side=3, adj=0.95, cex=0.65)
}

```
#Next two code chunks are also exploratory in nature - examining correlations
#Individual Sentiment Data correlations
This code chunk examines correlations between all individual sentiments and total satisfaction
```{r fig1, fig.height=7, fig.width=7, fig.align="center"}

panel.cor <- function(x, y, digits=2, prefix="", cex.cor, ...){ 
  #begin panel.cor function
	usr <- par("usr"); on.exit(par(usr))
	par(usr = c(0, 1, 0, 1))
	r <- abs(cor(x, y, use="pairwise.complete.obs", method="kendall"))
	txt <- format(c(r, 0.123456789), digits=digits)[1]
	txt <- paste(prefix, txt, sep="")
	if(missing(cex.cor)) cex.cor <- 0.8/strwidth(txt)
	text(0.5, 0.5, txt, cex = cex.cor * r)
} #end function

par(omi=c(0,0,0,0), mai=c(0.3,0.3,0.3,0.3), 
      tck=-0.01, mgp=c(1.0,0.35,0))

pairs(sentiments, pch=21, bg="grey", lower.panel=panel.cor, 
      upper.panel=panel.smooth) #plots correlations in sentiment


```

#Objective 2 Correlations between individual and total sentiments
```{r fig1, fig.height=3, fig.width=8, fig.align="center"}
par(mfrow=c(1,5), pty="s", omi=c(0,0,0,0), mai=c(0.3,0.3,0.3,0.25),
    mgp=c(1.0,0.25,0), tck=-0.01)
noplot <- c("wildlife.s","crowd.s")
ttls <- c("Bugs","Wildlife","Crowds","Trails","Weather",
          "Views","Wildflowers", "Total")

for(i in 1:(dim(sentiments)[2]-1)){
  tot <- sentiments$total.s
  ind <- sentiments[,i]
  if(dimnames(sentiments)[[2]][i] %in% noplot == TRUE){next}
  plot(ind, tot, xlim=c(0.5,5), ylim=c(0.5,5), xlab = "Individual Sentiment",
       ylab = "Total Sentiment", pch=21, bg="lightblue")
  title(ttls[i])
  
  #simple correlation
  indtest <- cor.test(ind,tot)
  cr <- round(indtest$estimate, 3)
  pcr <- round(indtest$p.value, 3)
  
  #add to graph
  mtext(paste("r=",cr,", p=", pcr, sep=""),line=-1, side=1, adj=0.95, cex=0.65)
}

```


#Objective 2
This chunk of code does the following:
+ recodes sentiments into categorical response variables
+ runs a one way analysis of variance with sentiment as explanatory, satisfaction as response
+ runs a posthoc Tukeys test to get at the differences between the categories

```{r }

#First recode individual sentiments, not total
sentiments_recode <- sentiments[,-dim(sentiments)[2]]

#now replace certain elements
sentiments_recode[sentiments_recode>3.5] <- "Pos"
sentiments_recode[sentiments_recode<2.5] <- "Neg"
sentiments_recode[sentiments_recode>=2.5 & sentiments_recode<=3.5] <- "Neut"
sentiments_recode[is.na(sentiments_recode)==TRUE] <- "NA"

#now reconstitute
for(i in 1:dim(sentiments_recode)[2]){
  sentiments_recode[,i] <- as.factor(sentiments_recode[,i])
}

#Put together with total sentiments
sentiments_recode <- cbind(sentiments_recode, sentiments$total.s)
dimnames(sentiments_recode)[[2]] <- dimnames(sentiments)[[2]]

#One way analysis of variance, print results

for(i in 1:(dim(sentiments_recode)[2]-1)){
  tot <- sentiments_recode$total.s
  ind <- sentiments_recode[,i]

  #simple anovas
  indtest <- lm(tot~ind)
  print(dimnames(sentiments_recode)[[2]][i])
  print(summary(indtest))
  print(anova(indtest))
  print(TukeyHSD(aov(indtest)))
  paov <- round(anova(indtest)$`Pr(>F)`[1],3)
  
}


```

#Objective 2: Random Forests with sentiments
This code chunk uses random forests to explore how total sentiment is related to individual sentiments. We exclude crowding and wildlife (low irr). We use the full dataset, with recoded individual sentiments (NA, Neg, Neutral, Pos). Results are in rf.recode

```{r fig, fig.height=4, fig.width=8, fig.align="center"}
#Random Forests with recoded sentiments
rf.recode <-randomForest(total.s ~ bug.s + trail.s + weather.s + view.s +
                        wildflower.s, data=sentiments_recode,
                        importance=TRUE, keep.inbag = TRUE, ntree=500)
#print, plot results
print(rf.recode, type=2)
par(mfrow=c(1,2), omi=c(0,0,0,0), mai=c(0.3,0.3,0.3,0.25),
    mgp=c(1.0,0.25,0), tck=-0.01, cex.axis=0.8)
varImpPlot(rf.recode, pch=21, bg="yellowgreen", main="Recoded")

#quick reminder: what proportion NAs in each individual sentiments?
for(i in 1:7){
  typ <- dimnames(sentiments)[[2]][i]
  propNA <- round(sum(is.na(sentiments[,i])) / dim(sentiments)[1], 3)
  print(paste(typ,": NA sentiments = ",propNA, sep=""))
}



```
#Now plot figure 3 for manuscript; 2 rows x 3 columns
1. Plot boxplots of individual sentiments (a-e)
2. Plot random forest (f)

```{r}
#```{r, fig.height=5, fig.width=8, fig.align="center"}

#pdf(file="output/figures/Fig3.pdf", width=8, height=5,
#    title="")
tiff(file="output/figures/Fig3.tif", width=8, height=5, units="in", res=1000)


#Make figure a - e, analyze
par(mfrow=c(2,3), pty="s", omi=c(0,0,0,0), mai=c(0.3,0.3,0.3,0.25),
    mgp=c(1.0,0.25,0), tck=-0.01, cex.axis=0.8)
noplot <- c("wildlife.s","crowd.s")
ttls <- c("Bugs","Wildlife","Crowds","Trails","Weather",
          "Views","Wildflowers", "Total")
lbl <- c("a)","n","n","b)","c)","d)","e)")

for(i in 1:(dim(sentiments_recode)[2]-1)){
  tot <- sentiments_recode$total.s
  ind <- sentiments_recode[,i]
  if(dimnames(sentiments)[[2]][i] %in% noplot == TRUE){next}
  boxplot(tot~ind, ylim=c(0.5,5.5), xlab = "Individual Sentiment",
          ylab = "Overall Hike Satisfaction", 
          col=c("grey","yellow","orange","orangered"))
  title(ttls[i])
  mtext(lbl[i], side=3, line=-1.1, cex=0.75, adj=0.025)
  
  #find sample size
  sampsize <- tapply(tot,ind,length)
  
  for(j in 1:4){
    post <- (0.25*j)-0.125
    mtext(sampsize[j], side=3, adj=post, cex=0.6, line=-1.5)
  }
  
  #p-values from simple anovas
  indtest <- lm(tot~ind)
  print(ttls[i])
  print(summary(indtest))
  print(anova(indtest))
  print(TukeyHSD(aov(indtest)))
  paov <- round(anova(indtest)$`Pr(>F)`[1],3)
  
  #add to graph
  if(paov>0){
    mtext(paste("p=", paov, sep=""),
        line=-1, side=1, adj=0.95, cex=0.65)}
    if(paov==0){
    mtext("p<0.001", line=-1, side=1, adj=0.95, cex=0.65)}
}

#Random Forests of all
rf.imp <- importance(rf.recode)
rf.imp <- rf.imp[order(rf.imp[,1]),]
rf.names <- c("bugs","weather","trails","wildflowers","views")

ypos <- c(1,2,3,4,5)
xmx <- 1.2*max(rf.imp[,1])
plot(rf.imp[,1], ypos, xlim =c(0,xmx), ylim=c(0.5,5.5), 
     type="n", xlab = "Importance (MSE)", ylab="Individual Sentiments",
     yaxt="n")

#title
title("Random Forest Regression")

#horizontal lines
for(i in 1:length(ypos)){
  lines(c(-1,rf.imp[i,1]), c(ypos[i],ypos[i]), lty=3)
}

#add points
points(rf.imp[,1], ypos, pch=21, bg="black", cex = 2)

#add labels
for(i in 1:dim(rf.imp)[1]){
  text((rf.imp[i,1]-2), (ypos[i]+0.2), labels=rf.names[i], adj=0.95)
}

#add f to label
mtext("f)", side=3, line=-1.1, cex=0.8, adj=0.025)

#finish pdf
dev.off()

```


#Objective 2 Misc: Exploring total sentiments with badges
This code chunk examines total sentiment as a function of:
1. Flower badge (yes, no)
2. Bugs (5 levels)
3. Year of data collection
```{r fig1, fig.width=6, fig.height=8}

par(mfrow=c(3,2), omi=c(0,0,0,0), mai=c(0.4,0.4,0.4,0.3), 
    mgp=c(1.0,0.4,0), tck=-0.01)

#Total sentiment vs. flowerbadge
test_flbadge <- lm(WTA_dat$total.s~as.factor(WTA_dat$flowerbadge))
summary(test_flbadge)
plot(WTA_dat$total.s~as.factor(WTA_dat$flowerbadge),
     col=c("yellowgreen","purple"), xlab="Flowerbadge", ylab="Sentiment")

#Total sentiment vs. bug
#first recode to ordinal
bugs.rc <- WTA_dat$bugs.summary
bugs.rc[bugs.rc[]=="No bugs"] <- 1
bugs.rc[bugs.rc[]=="Bugs were not too bad"] <- 2
bugs.rc[bugs.rc[]=="Bugs were an annoyance"] <- 3
bugs.rc[bugs.rc[]=="Bugs were terrible"] <- 4
bugdat <- WTA_dat; bugdat$bugs.rc <- bugs.rc
bugdat <- bugdat[is.na(bugdat$bugs.summary)==FALSE,]
test_bug <- lm(bugdat$total.s~bugdat$bugs.rc)
summary(test_bug)
plot(bugdat$total.s~as.factor(bugdat$bugs.rc), 
     xlab="Bugs", ylab="Sentiment", cex.axis=0.6)

#Total sentiment vs. snow
snow.rc <- WTA_dat$snow.summary
snow.rc[snow.rc[]=="Snow free"] <- 1
snow.rc[snow.rc[]=="Intermittent snow - not hard to cross"] <- 2
snow.rc[snow.rc[]=="Snowfields to cross - could be difficult"] <- 3
snow.rc[snow.rc[]=="Trail snow-covered at times - gear and expertise recommended"] <- 4
snow.rc[snow.rc[]=="Avalanche danger"] <- 5
snowdat <- WTA_dat; snowdat$snow.rc <- bugs.rc
snowdat <- snowdat[is.na(snowdat$snow.summary)==FALSE,]
test_snow <- lm(snowdat$total.s~snowdat$snow.rc)
summary(test_snow)
plot(snowdat$total.s~as.factor(snowdat$snow.rc), 
     xlab="Snow", ylab="Sentiment", cex.axis=0.6)

#Total sentiment vs. year
test_year <- lm(WTA_dat$total.s~as.factor(WTA_dat$year))
summary(test_year)
plot(WTA_dat$total.s~as.factor(WTA_dat$year),
     xlab="year", ylab="Sentiment")

#Total sentiment vs. trail
test_trail <- lm(WTA_dat$total.s~as.factor(WTA_dat$trail))
summary(test_trail)
plot(WTA_dat$total.s~as.factor(WTA_dat$trail),
     xlab="year", ylab="Sentiment")

```

#Objective 3: Combine WTA and MW data
```{r}
# read in MW data
MW_flower_dat <- read.csv("output/FloweringRichness.csv", header=TRUE)

# Add DOY to WTA data
# Calculate Julian Days of observations
DOY <- c()

# Convert the 'Date' - observed date to Julian (DOY)
for(i in 1:dim(WTA_dat)[1]){
  year <- WTA_dat$year[i]
  month <- WTA_dat$month[i]
  day <- WTA_dat$day[i]
  tmpdate <- paste(month,day,year, sep=" ")
  Jan1Jul <- as.Date(paste(year,"-01-01", sep=""))
  ObsJulDayYr <- julian(as.Date(tmpdate,"%B %d %Y"),
                        origin=Jan1Jul)
  DOY <- c(DOY,ObsJulDayYr)
}

WTA_dat$DOY <- DOY

# Change WTA_dat trail name to GB, RL (for merging)
WTA_dat$trail[WTA_dat$trail=="glacier basin"] <- "GB"
WTA_dat$trail[WTA_dat$trail=="skyline loop"] <- "RL"

# merge WTA_dat with flowering richness
WTA_MW_dat <- merge(WTA_dat, MW_flower_dat, by = c("trail","year","DOY"))

# make data frame
WTA_MW_dat <- data.frame(WTA_MW_dat)

# change storage mode
WTA_MW_dat$year <- as.factor(WTA_MW_dat$year)
WTA_MW_dat$flowerbadge <- as.factor(WTA_MW_dat$flowerbadge)
WTA_MW_dat$flseason <- as.factor(WTA_MW_dat$flseason)
WTA_MW_dat$trail <- as.factor(WTA_MW_dat$trail)
head(WTA_MW_dat)

# save to output
write.csv(WTA_MW_dat, file = "output/WTA_MW_dat.csv", quote=FALSE,
          row.names=FALSE)

```


# Objective 3: recode overall trail sentiments
```{r fig1, fig.width=2.75, fig.height=5}

# Recategorize to ordinal
# First, original data
total.s1 <- round(WTA_MW_dat$total.s)

#Now, negative, neutral to slightly neutral, positive
total.s2 <- WTA_MW_dat$total.s
total.s2[WTA_MW_dat$total.s<=3] <- 1
total.s2[WTA_MW_dat$total.s>3 & WTA_MW_dat$total.s<=4] <- 2
total.s2[WTA_MW_dat$total.s>4] <- 3

#Combine with MW_WTA_dat
WTA_MW_dat$total.s1 <- as.ordered(total.s1)
WTA_MW_dat$total.s2 <- as.ordered(total.s2)

# Histogram of different schemes
par(mfrow=c(2,1), omi=c(0,0,0,0), mai=c(0.4,0.4,0.4,0.3),
    tck=-0.02, mgp=c(1.2,0.4,0))

hist(WTA_MW_dat$total.s, main="Raw Sentiments", xlab="sentiments",
     ylab="observations", breaks=c(0,1,2,3,4,5), 
     freq=TRUE, col="navyblue")
hist(total.s2, main="Recode (neg,neut,pos)", xlab="sentiments",
     ylab="observations", breaks=c(0,1,2,3), 
     freq=TRUE, col="lightblue")


```

# Objective 3: Ordinal regressions and model selection
```{r }
#Ordinal regression: year and richness (s1)
#ordr_s1_null <- polr(total.s1~1, data=WTA_MW_dat)
#ordr_s1_yr <- polr(total.s1~as.factor(year), data=WTA_MW_dat)
#ordr_s1_rch <- polr(total.s1~rich, data=WTA_MW_dat)
#ordr_s1_trl <- polr(total.s1~as.factor(trail), data=WTA_MW_dat)
#ordr_s1_yrrch <- polr(total.s1~rich+as.factor(year), data=WTA_MW_dat)
#ordr_s1_yrtrl <- polr(total.s1~as.factor(year)+as.factor(trail),
#                      data=WTA_MW_dat)
#ordr_s1_trlrch <- polr(total.s1~rich+as.factor(trail), data=WTA_MW_dat)
#various tests
#anova(ordr_s1_rch, ordr_s1_null)
#anova(ordr_s1_yrrch, ordr_s1_yr)
#anova(ordr_s1_trlrch, ordr_s1_trl)
#AIC(ordr_s1_null, ordr_s1_yr, ordr_s1_rch, ordr_s1_trl, 
#    ordr_s1_yrrch, ordr_s1_yrtrl, ordr_s1_trlrch)

#Ordinal regression: year and richness (s2)
ordr_s2_null <- polr(total.s2~1, data=WTA_MW_dat, Hess=T)
ordr_s2_yr <- polr(total.s2~year, data=WTA_MW_dat, Hess=T)
ordr_s2_rch <- polr(total.s2~rich, data=WTA_MW_dat, Hess=T)
ordr_s2_trl <- polr(total.s2~trail, data=WTA_MW_dat, Hess=T)
ordr_s2_yrrch <- polr(total.s2~rich+year, data=WTA_MW_dat, Hess=T)
ordr_s2_yrtrl <- polr(total.s2~year+trail, data=WTA_MW_dat, Hess=T)
ordr_s2_trlrch <- polr(total.s2~rich+trail, data=WTA_MW_dat, Hess=T)
ordr_s2_yrxrch <- polr(total.s2~rich*year, data=WTA_MW_dat, Hess=T)
ordr_s2_yrxtrl <- polr(total.s2~year*trail, data=WTA_MW_dat, Hess=T)
ordr_s2_trlxrch <- polr(total.s2~rich*trail, data=WTA_MW_dat, Hess=T)
allmodsr <- list(ordr_s2_null, ordr_s2_yr, ordr_s2_rch, ordr_s2_trl, 
            ordr_s2_yrrch, ordr_s2_yrtrl, ordr_s2_trlrch, 
            ordr_s2_yrxrch, ordr_s2_yrxtrl, ordr_s2_trlxrch)

#various tests
#anova(ordr_s2_rch, ordr_s2_null)
#anova(ordr_s2_yrrch, ordr_s2_yr)
#anova(ordr_s2_trlrch, ordr_s2_trl)

#Model selection
AICr <- AIC(ordr_s2_null, ordr_s2_yr, ordr_s2_rch, ordr_s2_trl, 
            ordr_s2_yrrch, ordr_s2_yrtrl, ordr_s2_trlrch, 
            ordr_s2_yrxrch, ordr_s2_yrxtrl, ordr_s2_trlxrch)
AICr[,2] <- AICr[,2] - min(AICr[,2])
print(AICr)

#print coefficients from best fitting
bestmod <- which(AICr[,2]==0)
print(summary(allmodsr[[bestmod]]))

#coefficients and p-values
rcoefs <- coef(summary(allmodsr[[bestmod]]))
p <- round(pnorm(abs(rcoefs[, "t value"]), lower.tail = FALSE) * 2,3)
rcoefs <- cbind(rcoefs, "p value" = p)
print(rcoefs)

#confidence intervals, rescale
cir <- confint(allmodsr[[bestmod]])
recoefs <- exp(cbind(OR = coef(allmodsr[[bestmod]]), cir))
print(recoefs)

#test proportional odds assumption
print(brant(allmodsr[[bestmod]]))



################
#Ordinal regression: year and peak (s1)
#ordf_s1_null <- polr(total.s1~1, data=WTA_MW_dat)
#ordf_s1_yr <- polr(total.s1~as.factor(year), data=WTA_MW_dat)
#ordf_s1_fl <- polr(total.s1~as.factor(flseason), data=WTA_MW_dat)
#ordf_s1_trl <- polr(total.s1~as.factor(trail), data=WTA_MW_dat)
#ordf_s1_yrfl <- polr(total.s1~as.factor(flseason) + 
#                        as.factor(year), data=WTA_MW_dat)
#ordf_s1_yrtrl <- polr(total.s1~as.factor(year)+as.factor(trail),
#                      data=WTA_MW_dat)
#ordf_s1_trlfl <- polr(total.s1~as.factor(flseason)+as.factor(trail), 
#                       data=WTA_MW_dat)
#various tests
#anova(ordf_s1_fl, ordf_s1_null)
#anova(ordf_s1_yrfl, ordf_s1_yr)
#anova(ordf_s1_trlfl, ordf_s1_trl)
#AIC(ordf_s1_null, ordf_s1_yr, ordf_s1_fl, ordf_s1_trl, 
#    ordf_s1_yrfl, ordf_s1_yrtrl, ordf_s1_trlfl)
    

#Ordinal regression: year and peak (s2)
ordf_s2_null <- polr(total.s2~1, data=WTA_MW_dat, Hess=T)
ordf_s2_yr <- polr(total.s2~year, data=WTA_MW_dat, Hess=T)
ordf_s2_fl <- polr(total.s2~flseason, data=WTA_MW_dat, Hess=T)
ordf_s2_trl <- polr(total.s2~trail, data=WTA_MW_dat, Hess=T)
ordf_s2_yrfl <- polr(total.s2~flseason + year, data=WTA_MW_dat, Hess=T)
ordf_s2_yrtrl <- polr(total.s2~year+trail, data=WTA_MW_dat, Hess=T)
ordf_s2_trlfl <- polr(total.s2~flseason+trail, data=WTA_MW_dat, Hess=T)
ordf_s2_yrxfl <- polr(total.s2~flseason*year, data=WTA_MW_dat, Hess=T)
ordf_s2_yrxtrl <- polr(total.s2~year*trail, data=WTA_MW_dat, Hess=T)
ordf_s2_trlxfl <- polr(total.s2~flseason*trail, data=WTA_MW_dat, Hess=T)
allmodsf <- list(ordf_s2_null, ordf_s2_yr, ordf_s2_fl, ordf_s2_trl, 
                 ordf_s2_yrfl, ordf_s2_yrtrl, ordf_s2_trlfl, 
                 ordf_s2_yrxfl, ordf_s2_yrxtrl, ordf_s2_trlxfl)

#various tests
#anova(ordf_s2_fl, ordf_s2_null)
#anova(ordf_s2_yrfl, ordf_s2_yr)
#anova(ordf_s2_trlfl, ordf_s2_trl)

AICf <- AIC(ordf_s2_null, ordf_s2_yr, ordf_s2_fl, ordf_s2_trl, 
            ordf_s2_yrfl, ordf_s2_yrtrl, ordf_s2_trlfl, 
            ordf_s2_yrxfl, ordf_s2_yrxtrl, ordf_s2_trlxfl)
AICf[,2] <- AICf[,2] - min(AICf[,2])
print(AICf)

#print coefficients from best fitting
bestmod <- which(AICf[,2]==0)
print(summary(allmodsf[[bestmod]]))

#coefficients and p-values
fcoefs <- coef(summary(allmodsf[[bestmod]]))
p <- round(pnorm(abs(fcoefs[, "t value"]), lower.tail = FALSE) * 2,3)
fcoefs <- cbind(fcoefs, "p value" = p)
print(fcoefs)

#confidence intervals, rescale
cif <- confint(allmodsf[[bestmod]])
fecoefs <- exp(cbind(OR = coef(allmodsf[[bestmod]]), cif))
print(fecoefs)

#assumption of proportional odds
print(brant(allmodsf[[bestmod]]))
```


#Figure 4: plot richness (category) vs. total sentiment, peak flowering (yes, no) vs total sentiment
```{r }
#fig1, fig.width=6.5, fig.height=3.0}
#pdf(file="output/figures/Fig4.pdf", width=7, height=3,
#    title="")

tiff(file="output/figures/Fig4.tif", width=7, height=3, units="in", res=1000)


# Figure 4 for manuscript
par(mfrow=c(1,2), omi=c(0,0,0,0), mai=c(0.4,0.4,0.35,0.3), 
    mgp=c(1.1,0.4,0), tck=-0.02)

rch <- WTA_MW_dat$rich
rch2 <- rch
rch2[rch[]==0] <- "0"
rch2[rch[]>0 & rch[]<=4] <- "1-4"
rch2[rch[]>4 & rch[]<=8] <- "5-8"
rch2[rch[]>8] <- "9+"
rch2 <- as.factor(rch2)
trl <- WTA_MW_dat$trail
snt <- WTA_MW_dat$total.s

boxplot(snt ~ rch2 + trl, xlim=c(0,10), ylim=c(1,5.5),
        xaxt = "n", cex.axis=0.75, at=c(1,2,3,4,6,7,8,9),
        xlab="", ylab = "Overall Hike Satisfaction", 
        col = c("yellowgreen","yellowgreen","yellowgreen","yellowgreen",
               "lightblue","lightblue","lightblue","lightblue"))
text(c(1,2,3,4,6,7,8,9), c(rep(0.7, times=8)), adj=0.5, xpd=NA, cex=0.6,
     labels=c("none","1-4","5-8","9+","none","1-4","5-8","9+"))
text(5, 0.4, labels=c("Flowering Richness"), adj=0.5, xpd=NA)
mtext("a)", side=3, line=0, cex=0.65, adj=0.025, xpd=NA)
legend(x="bottomright", legend=c("GB","RL"),
       fill=c("yellowgreen","lightblue"), cex=0.75)

#second graph
fl <- WTA_MW_dat$flseason
trl <- as.factor(WTA_MW_dat$trail)
snt <- WTA_MW_dat$total.s

boxplot(snt ~ fl + trl, ylab = "Overall Hike Satisfaction", xlab="", 
        ylim=c(1,5.5), at=c(1,2,3.5,4.5), cex.axis=0.75, xaxt = "n",
        col=c("yellowgreen","yellowgreen",
              "lightblue","lightblue"))
text(c(1.5, 4), c(0.4, 0.4), labels=c("GB", "RL"), adj=0.5, xpd=NA)
text(c(1,2,3.5,4.5), c(5.4,5.4,5.4,5.4), cex=0.6,  
     labels=c("no flwrs", "peak","no flwrs", "peak"), adj=0.5, xpd=NA)
mtext("b)", side=3, line=0, cex=0.65, adj=0.025, xpd=NA)

dev.off()

```

#Check Fig 4 - right order?
```{r fig1, fig.width=9, fig.height=3.0}

#Make two graphs
par(mfrow=c(1,2), omi=c(0,0,0,0), mai=c(0.4,0.4,0.35,0.3), 
    mgp=c(1.1,0.4,0), tck=-0.02)

rch <- WTA_MW_dat$rich
rch2 <- rch
rch2[rch[]==0] <- "0"
rch2[rch[]>0 & rch[]<=4] <- "1-4"
rch2[rch[]>4 & rch[]<=8] <- "5-8"
rch2[rch[]>8] <- "9+"
rch2 <- as.factor(rch2)
trl <- WTA_MW_dat$trail
snt <- WTA_MW_dat$total.s

catrichstat <- boxplot(snt ~ rch2 + trl, ylim=c(1,5.5), cex.axis=0.5)

#second graph
fl <- WTA_MW_dat$flseason
trl <- as.factor(WTA_MW_dat$trail)
snt <- WTA_MW_dat$total.s

peakstat <- boxplot(snt ~ fl + trl, ylim=c(1,5.5), cex.axis=0.5)



```
#In progress - playing around for some alternative Figure 4
```{r, fig1, fig.width=6.5, fig.height=3.0}

library(vioplot)

# Figure 4 for manuscript
par(mfrow=c(1,2), omi=c(0,0,0,0), mai=c(0.4,0.4,0.35,0.3), 
    mgp=c(1.1,0.4,0), tck=-0.02)

rch <- WTA_MW_dat$rich
rch2 <- rch
rch2[rch[]==0] <- "0"
rch2[rch[]>0 & rch[]<=4] <- "1-4"
rch2[rch[]>4 & rch[]<=8] <- "5-8"
rch2[rch[]>8] <- "9+"
rch2 <- as.factor(rch2)
trl <- as.factor(WTA_MW_dat$trail)
snt <- WTA_MW_dat$total.s
snt2 <- as.numeric(WTA_MW_dat$total.s2)

pltcl <- as.character(trl)
pltcl[pltcl[]=="GB"] <- "yellowgreen"
pltcl[pltcl[]=="RL"] <- "lightblue"

#by trail 

vioplot(snt ~ rch2 + trl, xlim=c(0,10), ylim=c(1,5),
        xaxt = "n", xlab="", ylab = "Total Hike Satisfaction",
        cex.axis=0.75, at=c(1,2,3,4,6,7,8,9),
        pch=21, vertical=TRUE,
        col = c("yellowgreen","yellowgreen","yellowgreen","yellowgreen",
               "lightblue","lightblue","lightblue","lightblue"))
text(c(1,2,3,4,6,7,8,9), c(rep(0.7, times=8)), adj=0.5, xpd=NA, cex=0.6,
     labels=c("none","1-4","5-8","9+","none","1-4","5-8","9+"))
text(5, 0.4, labels=c("Flowering Richness"), adj=0.5, xpd=NA)
mtext("a)", side=3, line=0, cex=0.65, adj=0.025, xpd=NA)
legend(x="bottomright", legend=c("GB","RL"),
       fill=c("yellowgreen","lightblue"), cex=0.75)

#second graph
fl <- WTA_MW_dat$flseason
trl <- as.factor(WTA_MW_dat$trail)
snt <- WTA_MW_dat$total.s

boxplot(snt ~ fl + trl, ylab = "Sentiment", xlab="", ylim=c(1,5),
        at=c(1,2,3.5,4.5), cex.axis=0.75, xaxt = "n",
        col=c("yellowgreen","yellowgreen",
              "lightblue","lightblue"))
text(c(1.5, 4), c(0.4, 0.4), labels=c("GB", "RL"), adj=0.5, xpd=NA)
text(c(1,2,3.5,4.5), c(5.4,5.4,5.4,5.4), cex=0.6,  
     labels=c("no flwrs", "peak","no flwrs", "peak"), adj=0.5, xpd=NA)
mtext("b)", side=3, line=0, cex=0.65, adj=0.025, xpd=NA)


```



#Ditto - Alternative Fig 4: continuous flowering richness (for reviewer response)
```{r fig1, fig.width=4, fig.height=8}

#set figure parameters
par(mfrow=c(3,1), omi=c(0,0,0,0), mai=c(0.4,0.4,0.35,0.3), 
    mgp=c(1.1,0.4,0), tck=-0.02)

rchRL <- WTA_MW_dat$rich[WTA_MW_dat$trail=="RL"]
sntRL <- as.numeric(WTA_MW_dat$total.s2[WTA_MW_dat$trail=="RL"])

rchGB <- WTA_MW_dat$rich[WTA_MW_dat$trail=="GB"]
sntGB <- as.numeric(WTA_MW_dat$total.s2[WTA_MW_dat$trail=="GB"])

#first Glacier Basin

plot(jitter(rchGB), jitter(sntGB), 
     xlim=c(0,12), ylim=c(0,3.5), pch=21, bg="magenta",
     xlab="Richness", ylab="Trail Satisfaction")
title("Glacier Basin")

plot(jitter(rchRL), jitter(sntRL), 
     xlim=c(0,12), ylim=c(0,3.5), pch=21, bg="magenta4",
     xlab="Richness", ylab="Trail Satisfaction")
title("Reflection Lakes")


#third graph
fl <- WTA_MW_dat$flseason
trl <- as.factor(WTA_MW_dat$trail)
snt <- WTA_MW_dat$total.s

boxplot(snt ~ fl + trl, ylab = "Sentiment", xlab="", ylim=c(1,5.5),
        at=c(1,2,3.5,4.5), cex.axis=0.75, xaxt = "n",
        col=c("magenta","magenta",
              "magenta4","magenta4"))
text(c(1.5, 4), c(0.4, 0.4), labels=c("GB", "RL"), adj=0.5, xpd=NA)
text(c(1,2,3.5,4.5), c(5.4,5.4,5.4,5.4), cex=0.6,  
     labels=c("no flwrs", "peak","no flwrs", "peak"), adj=0.5, xpd=NA)
mtext("b)", side=3, line=0, cex=0.65, adj=0.025, xpd=NA)


```
