---
title: "MW_WTAanalysis"
author: "Janneke Hille Ris Lambers, Aji John, Meera Sethi, Elli Theobald"
date: "12/22/2020"
output: html_document
---

# Setup R markdown, load packages
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(ggplot2)
library(MASS)
library(boot)
library(dplyr)
library(randomForest)
```

#Objective 1
This code chunk:
1. Reads in necessary data
     +read in NPS visitation data
     +read in peak flowering data (per plot, year, species)
     +read in WTA data
     +read flowering richness by day
2. Creates a data frame of NPS visits, peak flowering, WTA posts
     +reconfigure NPS visitation data, subset to years / months
     +WTA data: count # reports per year month
     +turn peak flowering estimates (julian day) into monthly data
3. Makes a figure of visits, WTA reports, peak flowering
4. Analysis?

**IN PROGRESS: code will need to be modified to deal with Skyline trail data**

```{r fig1, fig.height=6, fig.width=3, fig.align="center"}

# Read in all necessary data
MW_rich_dat <- read.csv("output/FloweringRichness.csv", header=TRUE)
MW_plot_dat_0 <- read.csv("output/Parameters_plotmodel.csv")
WTA_dat_0 <- read.csv("data/GB_WTA.csv", header=TRUE)
NPS_dat_0 <- read.csv("data/Visitation by Month.csv")

## FOR OBJECTIVE 1
# Create timing data frame with 5 columns
# year, type (visitor, WTA, peak), trail, month, # items
# Note - constrain to April, May, Jun, Jul, Aug, Sep
# TODO - this code seems really inefficient, not sure how to improve...

#  NPS data - recreational visits
yr_nps <- rep(NPS_dat_0$Year, times=6)
typ_nps <- as.factor(rep("NPS", times=length(yr_nps)))
trail_nps <- rep(NA, times=length(yr_nps))
month_nps <- as.factor(rep(c("Apr","May","Jun","Jul","Aug","Sep"),
                      each=dim(NPS_dat_0)[1]))
nitems_nps <- c(NPS_dat_0$APR, NPS_dat_0$MAY, NPS_dat_0$JUN, 
                NPS_dat_0$JUL, NPS_dat_0$AUG, NPS_dat_0$SEP)
NPS_dat_1 <- data.frame(yr_nps, typ_nps, trail_nps, 
                   month_nps, nitems_nps)
NPS_dat <- NPS_dat_1[NPS_dat_1$yr_nps>2012,]
dimnames(NPS_dat)[[2]] <- c("year","type","trail",
                            "month","n")

# WTA data - # reports per month
WTA_dat_1 <- subset(WTA_dat_0, select=c(orig.position, trail, year, month))
WTA_dat_2 <- distinct(WTA_dat_1)
WTA_dat_3 <- WTA_dat_2[WTA_dat_2$year>2014,]
WTA_dat_3$month <- substring(WTA_dat_3$month,1,3)
WTA_dat_3$trail[WTA_dat_3$trail=="glacier basin"] <- "GB"
WTA_dat_3$trail[WTA_dat_3$trail=="Reflection lakes"] <- "RL"
mnths <- c("Apr","May","Jun","Jul","Aug","Sep")
mnthskeep <- WTA_dat_3$month %in% mnths
WTA_dat_4 <- WTA_dat_3[mnthskeep,]
WTA_dat_4$trail <- as.factor(WTA_dat_4$trail)
WTA_dat_4$month <- as.factor(WTA_dat_4$month)
WTA_dat_5a <- WTA_dat_4 %>% 
  group_by(year, trail, month)%>% 
  tally() %>% as.data.frame()

#Add zeros to WTA data (NB - will need to add skyline trail)
WTA_dat_5b <- NPS_dat
WTA_dat_5b <- WTA_dat_5b[WTA_dat_5b$year>2014,]
WTA_dat_5b$type <- "WTA"
WTA_dat_5b$trail <- "GB"
WTA_dat_5b$n <- 0
WTA_dat_5c <- merge(WTA_dat_5b, WTA_dat_5a, all.x=TRUE,
                    by=c("year","trail","month"))
WTA_dat_5c$n.y[is.na(WTA_dat_5c$n.y)==TRUE] <- 0
WTA_dat_5c$n.x <- NULL
dimnames(WTA_dat_5c)[[2]][5] <- "n"
colorder <- dimnames(NPS_dat)[[2]]
WTA_dat <- WTA_dat_5c[,colorder]

# MW data - number of species in peak flower per month
dimnames(MW_plot_dat_0)[[2]][2] <- "trail"
MW_plot_dat_0$trail[MW_plot_dat_0$trail=="Reflection Lakes"] <- "RL"
MW_plot_dat_0$trail[MW_plot_dat_0$trail=="Glacier Basin"] <- "GB"
keepcol <- c("year","trail","species","peak")
MW_plot_dat_1 <- MW_plot_dat_0[,keepcol]
MW_plot_dat_1$peak <- round(MW_plot_dat_1$peak)
Jan1Jul <- as.Date(paste(MW_plot_dat_1$year,"-01-01", sep=""))
MW_date <- as.Date(MW_plot_dat_1$peak, origin = Jan1Jul)
MW_plot_dat_1$month <- format(MW_date, "%b")
MW_plot_dat_1$type <- "MW"
MW_dat_2a <- MW_plot_dat_1 %>% 
  group_by(year, trail, month)%>% 
  tally() %>% as.data.frame()

# MW data - add zeros
MW_dat_1a <- NPS_dat
MW_dat_1a <- MW_dat_1a[MW_dat_1a$year>2012,]
MW_dat_1a$type <- "MW"
MW_dat_1a$trail <- "GB"
MW_dat_1b <- MW_dat_1a
MW_dat_1b$trail <- "RL"
MW_dat_2b <- rbind(MW_dat_1a, MW_dat_1b)
MW_dat_2b$n <- 0
MW_dat_3  <- merge(MW_dat_2b, MW_dat_2a, all.x=TRUE,
                    by=c("year","trail","month"))
MW_dat_3$n.y[is.na(MW_dat_3$n.y)==TRUE] <- 0
MW_dat_3$n.x <- NULL
dimnames(MW_dat_3)[[2]][5] <- "n"
colorder <- dimnames(NPS_dat)[[2]]
MW_dat_3 <- MW_dat_3[,colorder]
MW_dat <- MW_dat_3[!(MW_dat_3$trail=="GB" & MW_dat_3$year<2015),]

# Make 3 panel figure showing all data over time
par(mfrow=c(3,1), omi=c(0,0,0,0), mai=c(0.4,0.4,0.4,0.3),
    mgp=c(1.2,0.4,0), tck=-0.02)

# first visitation
yrs <- unique(NPS_dat$year); yrs <- c(2013,2014,2016,2017,2018,2019,2015)
mxvis <- max(NPS_dat$n) / 1000
yrcols <- c("grey","grey","grey","grey","grey","grey","orange")
month_num <- match(NPS_dat$month, month.abb)
NPS_dat$month_num <- month_num

plot(c(6,1), type="n", xaxt="n", xlim=c(3.5,9.5), ylim=c(0,mxvis),
     xlab="Month", ylab="Visits (1000's)")
title("NPS visition")
text(c(4,5,6,7,8,9), mxvis*-0.1, xpd=NA, 
      labels=c("Apr","May","June","July","Aug","Sep"))
legend(x="topleft", legend=c("Average climate year", "CC analog year"), 
       cex=0.75, pch=21, pt.bg=c("grey","orange"), pt.cex=c(1.25, 2))

for(i in 1:length(yrs)){
  yrvisits <- NPS_dat[NPS_dat$year==yrs[i],]
  lines(yrvisits$month_num, yrvisits$n/1000)
}

for(i in 1:length(yrs)){
  yrvisits <- NPS_dat[NPS_dat$year==yrs[i],]
  ifelse(i<7, ptsize<-1.25, ptsize<-2)
  points(yrvisits$month_num, yrvisits$n/1000, cex=ptsize, pch=21, bg=yrcols[i])
}

# WTA_dat
month_num <- match(WTA_dat$month, month.abb)
WTA_dat$month_num <- month_num

plot(c(6,1), type="n", xaxt="n", xlim=c(3.5,9.5), ylim=c(0,0.5),
     xlab="Month", ylab="Proportion")
title("WTA Trip Reports: GB")
text(c(4,5,6,7,8,9), -0.05, xpd=NA, 
      labels=c("Apr","May","June","July","Aug","Sep"))

for(i in 1:length(yrs)){
  yrvisits <- WTA_dat[WTA_dat$year==yrs[i],]
  yrvisits <- yrvisits[order(yrvisits$month_num),]
  lines(yrvisits$month_num, yrvisits$n/sum(yrvisits$n))
}

for(i in 1:length(yrs)){
  yrvisits <- WTA_dat[WTA_dat$year==yrs[i],]
  ifelse(i<7, ptsize<-1.25, ptsize<-2)
  points(yrvisits$month_num, yrvisits$n/sum(yrvisits$n), 
          cex=ptsize, pch=21, bg=yrcols[i])
}

# MW_dat
month_num <- match(MW_dat$month, month.abb)
MW_dat$month_num <- month_num

plot(c(6,1), type="n", xaxt="n", xlim=c(3.5,9.5), ylim=c(0,0.8),
     xlab="Month", ylab="Proportion")
title("Peak Flowering: GB")
text(c(4,5,6,7,8,9),-0.08, xpd=NA, 
      labels=c("Apr","May","June","July","Aug","Sep"))

for(i in 1:length(yrs)){
  yrvisits <- MW_dat[MW_dat$year==yrs[i]&MW_dat$trail=="GB",]
  yrvisits <- yrvisits[order(yrvisits$month_num),]
  lines(yrvisits$month_num, yrvisits$n/sum(yrvisits$n))
}

for(i in 1:length(yrs)){
  yrvisits <- MW_dat[MW_dat$year==yrs[i]&MW_dat$trail=="GB",]
  ifelse(i<7, ptsize<-1.25, ptsize<-2)
  points(yrvisits$month_num, yrvisits$n/sum(yrvisits$n), 
          cex=ptsize, pch=21, bg=yrcols[i])
}
```


#Objective 2A (next few code chunks)
This code chunk:
1. Reads in WTA data
2. Averages across sentiments (after removing NA's)
3. Explores sentiments
  +How many NAs?
  +Histogram of sentiments?

**IN PROGRESS**

```{r fig1, fig.height=7, fig.width=4.5, fig.align="center"}
# Read in all necessary data
WTA_dat_0 <- read.csv("data/GB_WTA.csv", header=TRUE)

# Remove some columns
WTA_dat_1 <- subset(WTA_dat_0, select=-c(pre.2013, dummy.random.order, link,
                                         other.trails, other.trails.mw, author, 
                                         flowers.in.pics.spp, spp.mentioned,
                                         wildflower.value.terms, value.terms, 
                                         flag, flag.comment, 
                                         flag.resolved.comment))
  
# Remove rows with NAs in overall sentiment
WTA_dat_2 <- WTA_dat_1[is.na(WTA_dat_1$overall.report.sentiment)==FALSE,]

# Only include years in which MW data was collected in GB
WTA_dat_3 <- WTA_dat_2[WTA_dat_2$year>2014,]

# new data set: average score, after NAs (this may not be the best way to go) 
reports <- unique(WTA_dat_3$orig.position)
WTA_dat_4 <- c()

for(i in 1:length(reports)){
  report_dat <- WTA_dat_3[WTA_dat_3$orig.position==reports[i],]
  info <- report_dat[1,c(1,3:12)]
  bug_s <- mean(report_dat$bugs.sentiment,na.rm=TRUE)
  if(is.nan(bug_s)==TRUE){bug_s <- NA}
  wild_s <- mean(report_dat$wildlife.sentiment,na.rm=TRUE)
  if(is.nan(wild_s)==TRUE){wild_s <- NA}
  crowd_s <- mean(report_dat$crowding.sentiment,na.rm=TRUE)
  if(is.nan(crowd_s)==TRUE){crowd_s <- NA}
  trail_s <- mean(report_dat$trail.condition.sentiment,na.rm=TRUE)
  if(is.nan(trail_s)==TRUE){trail_s <- NA}
  weather_s <- mean(report_dat$weather.sentiment,na.rm=TRUE)
  if(is.nan(weather_s)==TRUE){weather_s <- NA}
  view_s <- mean(report_dat$view.sentiment,na.rm=TRUE)
  if(is.nan(view_s)==TRUE){view_s <- NA}
  wildflower_s <- mean(report_dat$wildflower.sentiment,na.rm=TRUE)
  if(is.nan(wildflower_s)==TRUE){wildflower_s <- NA}
  total_s <- mean(report_dat$overall.report.sentiment,na.rm=TRUE)
  newrow <- cbind(info,bug_s, wild_s, crowd_s, trail_s, 
              weather_s, view_s, wildflower_s, total_s)
  WTA_dat_4 <-rbind(WTA_dat_4,newrow)
}

# Check how many NA's per sentiment score
for(i in 12:19){
  ns <- length(na.omit(WTA_dat_4[,i]))
  print(paste(dimnames(WTA_dat_4)[[2]][i],"-", 
              ns, " of ", dim(WTA_dat_4)[1]))
}

# Turn it into WTA_dat
WTA_dat <- WTA_dat_4

# Make histogram of sentiments
par(mfrow=c(4,2), omi=c(0,0,0,0), mai=c(0.4,0.4,0.4,0.4), 
    tck=-0.02, mgp=c(1.1,0.4,0))

for(i in 12:19){
  hist(WTA_dat[,i], col="grey", xlab="sentiment",ylab="freq",
       breaks=c(0,1,2,3,4,5), main=dimnames(WTA_dat)[[2]][i])
  mean_s <- round(mean(na.omit(WTA_dat[,i])),2)
  mtext(paste("mean=",mean_s, sep=""), side=3, adj=0.95, cex=0.65)
}

```

#Objective 2
This code chunk examines correlations between sentiments
```{r fig1, fig.height=7, fig.width=7, fig.align="center"}
# correlations between sentiment scores
sentiments <- subset(WTA_dat, select=c(bug_s, wild_s, crowd_s,
                                       trail_s, weather_s,
                                       view_s, wildflower_s, total_s))
                     

panel.cor <- function(x, y, digits=2, prefix="", cex.cor, ...){ 
  #begin panel.cor function
	usr <- par("usr"); on.exit(par(usr))
	par(usr = c(0, 1, 0, 1))
	r <- abs(cor(x, y, use="pairwise.complete.obs", method="kendall"))
	txt <- format(c(r, 0.123456789), digits=digits)[1]
	txt <- paste(prefix, txt, sep="")
	if(missing(cex.cor)) cex.cor <- 0.8/strwidth(txt)
	text(0.5, 0.5, txt, cex = cex.cor * r)
} #end function

par(omi=c(0,0,0,0), mai=c(0.3,0.3,0.3,0.3), 
      tck=-0.01, mgp=c(1.0,0.35,0))

pairs(sentiments, pch=21, bg="grey", lower.panel=panel.cor, 
      upper.panel=panel.smooth) #plots correlations in sentiment

```

#Objective 2: Total sentiment tests
This code chunk examines total sentiment as a function of:
1. Flower badge (yes, no)
2. Bugs (5 levels)
3. Year of data collection
```{r fig1, fig.width=4, fig.height=8}

par(mfrow=c(3,1), omi=c(0,0,0,0), mai=c(0.4,0.4,0.4,0.3), 
    mgp=c(1.0,0.4,0), tck=-0.01)

#Total sentiment vs. flowerbadge
test_flbadge <- lm(WTA_dat$total_s~as.factor(WTA_dat$flowerbadge))
summary(test_flbadge)
plot(WTA_dat$total_s~as.factor(WTA_dat$flowerbadge),
     col=c("yellowgreen","purple"), xlab="Flowerbadge", ylab="Sentiment")

#Total sentiment vs. bug
bugdat <- WTA_dat[is.na(WTA_dat$bugs.summary)==FALSE,]
test_bug <- lm(bugdat$total_s~bugdat$bugs.summary)
summary(test_bug)
plot(bugdat$total_s~as.factor(bugdat$bugs.summary), 
     xlab="Bugs", ylab="Sentiment")

#Total sentiment vs. year
test_year <- lm(WTA_dat$total_s~as.factor(WTA_dat$year))
summary(test_year)
plot(WTA_dat$total_s~as.factor(WTA_dat$year),
     xlab="year", ylab="Sentiment")

```

#Random forests
```{r}
sentiments <- WTA_dat[,c('wild_s', 'crowd_s','trail_s',
                         'weather_s','view_s','wildflower_s','total_s')]

# Imputing
sentiments.imputed <- rfImpute(total_s ~ ., sentiments)
bag.sentiments.i <-randomForest(total_s ~ . , data=sentiments.imputed,
                             importance=TRUE, keep.inbag = TRUE, ntree=500)

# View the forest results.
print(bag.sentiments.i) 

# Importance of each predictor.
print(importance(bag.sentiments.i,type = 2)) 

#extract importance values
importrf <- as.data.frame(importance(bag.sentiments.i,type = 2))
importrf[,1] <- importrf[order(importrf$IncNodePurity, 
                               decreasing = TRUE),1]
barplot(importrf[,1], names.arg = dimnames(importrf)[[1]],
        xlab="Experiences", ylab="Importance", col="yellowgreen")
title("Imputed")

# Replace with 3
sentiments.neutral <- sentiments
sentiments.neutral[is.na(sentiments.neutral)] <- 3
bag.sentiments.n <-randomForest(total_s ~ . , data=sentiments.neutral,
                             importance=TRUE, keep.inbag = TRUE, ntree=500)

# View the forest results.
print(bag.sentiments.n) 

# Importance of each predictor.
print(importance(bag.sentiments.n,type = 2)) 

#extract importance values
importrf <- as.data.frame(importance(bag.sentiments.n,type = 2))
importrf[,1] <- importrf[order(importrf$IncNodePurity, 
                               decreasing = TRUE),1]
barplot(importrf[,1], names.arg = dimnames(importrf)[[1]],
        xlab="Experiences", ylab="Importance", col="yellowgreen")
title("NA = Neutral")
```


#Objective 3
```{r}
# Add DOY to WTA data
# Calculate Julian Days of observations
DOY <- c()

# Convert the 'Date' - observed date to Julian (DOY)
for(i in 1:dim(WTA_dat)[1]){
  year <- WTA_dat$year[i]
  month <- WTA_dat$month[i]
  day <- WTA_dat$day[i]
  tmpdate <- paste(month,day,year, sep=" ")
  Jan1Jul <- as.Date(paste(year,"-01-01", sep=""))
  ObsJulDayYr <- julian(as.Date(tmpdate,"%B %d %Y"),
                        origin=Jan1Jul)
  DOY <- c(DOY,ObsJulDayYr)
}

WTA_dat$DOY <- DOY

# Change WTA_dat trail name to GB, RL (for merging)
WTA_dat$trail[WTA_dat$trail=="glacier basin"] <- "GB"
WTA_dat$trail[WTA_dat$trail=="skyline trail"] <- "RL"

# merge WTA_dat with flowering richness
WTA_MW_dat <- merge(WTA_dat, MW_rich_dat, by = c("trail","year","DOY"))

# make data frame
WTA_MW_dat <- data.frame(WTA_MW_dat)

# change storage mode
WTA_MW_dat$year <- as.factor(WTA_MW_dat$year)
WTA_MW_dat$flowerbadge <- as.factor(WTA_MW_dat$flowerbadge)
head(WTA_MW_dat)

# save to output
write.csv(WTA_MW_dat, file = "output/WTA_MW_dat.csv", quote=FALSE,
          row.names=FALSE)

```



#This and That
This chunk of code makes several figures to explore WTA data
```{r}

# Various graphs over time
# Violin plot of trip reports in each year
ggplot(WTA_MW_dat, aes(x=DOY, y=year)) + 
  geom_violin(trim=FALSE, fill=year)  +
  scale_x_continuous(breaks=seq(0,360,30)) +
  labs(title="Visits to Glacier Basin", 
       x="Day of Year", y = "Year")

# Violin plot of trip reports over all years vs. flower badges
ggplot(WTA_MW_dat, aes(x=DOY, y=flowerbadge, fill=flowerbadge)) + 
  geom_violin(trim=FALSE)  +
  scale_x_continuous(breaks=seq(0,360,30)) +
  labs(title="Visits to Glacier Basin", 
       x="Day of Year", y = "Flower Badge")
  
# Fit phenology curve to flower badges, plot all years
source("./HRL_phenology_functions.R")

#make a dummy plot to add lines to
yrs <- unique(WTA_MW_dat$year); yrs <- yrs[order(yrs)]; nyrs <- length(yrs)
yrcols <- c("purple","blue","orange","yellowgreen","pink")
par(mfrow=c(1,1), omi=c(0,0,0,0), mai=c(0.5,0.6,0.5,0.5), 
      tck=-0.02, mgp=c(1.1,0.5,0))
plot(1,1, type="n", xlim=c(120,300),
       ylim=c(0,1), xlab="", ylab="Flower Badges", pin=c(6,4),
       xaxp=c(120, 300, 6))
title("Flower Badge Phenology")
legend(x="topright", legend=yrs, col=yrcols, lwd=2)
  
# Now estimate for each year, add line
for(i in 1:nyrs){
  XX_DOY <- seq(120,300)
  WTA_dat_yr <- WTA_MW_dat[WTA_MW_dat$year==yrs[i],]
  days <- WTA_dat_yr$DOY
  phenophase <- rep(0, times=dim(WTA_dat_yr)[1])
  phenophase[WTA_dat_yr$flowerbadge=="yes"] <- 1
  param <- c(mean(days[phenophase[]==1]), -0.001, 0)
  FBmod <- optim(param, curvefit_perplot, control = list(maxit = 50000))
  predf <- predflower(XX_DOY, FBmod$par)
  lines(XX_DOY, predf, col=yrcols[i], lwd=2)
}

# correlations between sentiment scores
sentiments <- subset(WTA_MW_dat, select=c(bug_s, wild_s, crowd_s,
                                       trail_s, weather_s,
                                       view_s, wildflower_s, total_s))
                     

panel.cor <- function(x, y, digits=2, prefix="", cex.cor, ...){ 
  #begin panel.cor function
	usr <- par("usr"); on.exit(par(usr))
	par(usr = c(0, 1, 0, 1))
	r <- abs(cor(x, y, use="pairwise.complete.obs", method="kendall"))
	txt <- format(c(r, 0.123456789), digits=digits)[1]
	txt <- paste(prefix, txt, sep="")
	if(missing(cex.cor)) cex.cor <- 0.8/strwidth(txt)
	text(0.5, 0.5, txt, cex = cex.cor * r)
} #end function

par(omi=c(0,0,0,0), mai=c(0.3,0.3,0.3,0.3), 
      tck=-0.01, mgp=c(1.0,0.35,0))

pairs(sentiments, pch=21, bg="grey", lower.panel=panel.cor, 
      upper.panel=panel.smooth) #plots correlations in sentiment

# Focuses in on total, view, wildflower, wildlife sentiment
sentiments2 <- sentiments #[,-c(bug_s,crowd_s,trail_s, weather_s)]
sentiments2$bug_s <- NULL
sentiments2$crowd_s <- NULL
sentiments2$trail_s <- NULL
sentiments2$weather_s <- NULL
pairs(sentiments2, pch=21, bg="grey", lower.panel=panel.cor, 
      upper.panel=panel.smooth) #plots correlations in sentiment  

```

# Preliminary analysis exploring sentiment scores
```{r}
#histogram of all sentiments
par(mfrow=c(2,4), omi=c(0,0,0,0), mai=c(0.4,0.4,0.4,0.4), 
    mgp=c(1.2,0.4,0), tck=-0.02)

hist(WTA_MW_dat$bug_s, xlim=c(1,5), main="Bugs", xlab="")
hist(WTA_MW_dat$wild_s, xlim=c(1,5), main="Wildlife", xlab="")
hist(WTA_MW_dat$crowd_s, xlim=c(1,5), main="Crowding", xlab="")
hist(WTA_MW_dat$trail_s, xlim=c(1,5), main="Trail condition", xlab="")
hist(WTA_MW_dat$weather_s, xlim=c(1,5), main="Weather", xlab="")
hist(WTA_MW_dat$view_s, xlim=c(1,5), main="Views", xlab="")
hist(WTA_MW_dat$wildflower_s, xlim=c(1,5), main="Wildflowers", xlab="")
hist(WTA_MW_dat$total_s, xlim=c(1,5), main="Total", xlab="")

# Recategorize sentiment (i.e. round so between 1 & 5) 
# for ordinal regression
WTA_MW_dat$total_s2 <- as.factor(round(WTA_MW_dat$total_s))

# Test correlations between wildflower, view, bug sentiment
WTA_MW_dat2 <- WTA_MW_dat[is.na(WTA_MW_dat$wildflower_s)==FALSE,]
test_ord_sent <- polr(total_s2~wildflower_s, data=WTA_MW_dat2)
test_ord_sent_0 <- polr(total_s2~1, data=WTA_MW_dat2)
anova(test_ord_sent, test_ord_sent_0)
summary(test_ord_sent)

#Average sentiment in trip reports w and w/o flower badges
test_lm_flwr <- lm(total_s ~ flowerbadge*year, data=WTA_MW_dat)
summary(test_lm_flwr)
summary(step(test_lm_flwr))
test_lm_rich <- lm(total_s ~ rich*year, data=WTA_MW_dat)
summary(test_lm_rich)
summary(step(test_lm_rich))

# sentiment as function of DOY and DOY^2
test_ord_null <- polr(total_s2 ~ 1, data=WTA_MW_dat)
test_ord_doy <- polr(total_s2 ~ DOY, data=WTA_MW_dat)
test_ord_doy2 <- polr(total_s2 ~ DOY+DOY^2, data=WTA_MW_dat)
anova(test_ord_null,test_ord_doy, test_ord_doy2)
AIC(test_ord_null,test_ord_doy, test_ord_doy2)
summary(test_ord_doy2)


# Year, flower badge and richness vs. total sentiment
# To be honest, I don't really know how to interpret the output
test_ord_null <- polr(total_s2 ~ 1, data=WTA_MW_dat)
test_ord_flwr <- polr(total_s2 ~ flowerbadge, data=WTA_MW_dat)
test_ord_rich <- polr(total_s2 ~ rich, data=WTA_MW_dat)
test_ord_yr <- polr(total_s2 ~ year, data=WTA_MW_dat)
test_ord_yrflwr <- polr(total_s2 ~ year*flowerbadge, data=WTA_MW_dat)
test_ord_yrrich <- polr(total_s2 ~ year*rich, data=WTA_MW_dat)

anova(test_ord_null,test_ord_flwr,test_ord_rich,
      test_ord_yr,test_ord_yrflwr,test_ord_yrrich)
AIC(test_ord_null,test_ord_flwr,test_ord_rich,
      test_ord_yr,test_ord_yrflwr,test_ord_yrrich)
summary(test_ord_yrrich)

```

